<html>

<head>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap-theme.min.css">

    <script src="https://unpkg.com/react@15.4.2/dist/react.js"></script>
    <script src="https://unpkg.com/react-dom@15.4.2/dist/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-bootstrap/0.30.8/react-bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <script src="https://npmcdn.com/react-router@3.0.2/umd/ReactRouter.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

</head>

<body>
    <div id="container">

    </div>

    <script type="text/babel">
        var {
            Router, Route, IndexRoute,
            IndexLink, hashHistory, Link
        } = ReactRouter;

        var PageHeader = ReactBootstrap.PageHeader;
        var Table = ReactBootstrap.Table;

        class YomiBase extends React.Component {

            constructor(props) {
                super(props);
                this.state = {};
            }

            componentDidMount() {
                var _this = this;
                this.serverRequest = axios
                    .get("data.json")
                    .then(function(result) {
                        _this.setState({
                            character: result.data.character
                        });
                    })
            }

            componentWillUnmount() {
                this.serverRequest.abort();
            }

            render() {
                if (this.state.character) {
                    return (
                        <section>
                            <PageHeader>YomiBase</PageHeader>
                            {CharacterSummary(this.state.character.summary)}
                            {Attacks(this.state.character.summary.name, this.state.character.attacks)}
                            {Throws(this.state.character.summary.name, this.state.character.throws)}
                        </section>
                    );
                } else {
                    return (
                        <section>
                            <PageHeader>YomiBase</PageHeader>
                        </section>
                    );
                }
            }
        };

        function CharacterSummary(props) {
            return (
                <section>
                    <Table>
                        <tbody>
                            <tr>
                                <td><strong>Normal attack speed</strong>:</td>
                                <td>x.{props.attackSpeed} (x = card rank)</td>
                            </tr>
                            <tr>
                                <td><strong>Normal throw speed</strong>:</td>
                                <td>x.{props.throwSpeed} (x = card rank) {props.throwCP} {props.throwKD}</td>
                            </tr>
                            <tr>
                                <td><strong>Normal throw damage</strong>:</td>
                                <td>{props.throwDamage}</td>
                            </tr>
                        </tbody>
                    </Table>
                    <Table>
                        <tbody>
                            <tr>
                                <td><strong>Attacks</strong>:</td>
                                <td>{props.attacks.join(', ')}</td>
                            </tr>
                            <tr>
                                <td><strong>Throws</strong>:</td>
                                <td>{props.throws.join(', ')}</td>
                            </tr>
                            <tr>
                                <td><strong>Blocks</strong>:</td>
                                <td>{props.blocks.join(', ')}</td>
                            </tr>
                            <tr>
                                <td><strong>Dodges</strong>:</td>
                                <td>{props.dodges.join(', ')}</td>
                            </tr>
                        </tbody>
                    </Table>
                </section>
            );
        };

        function SortingHeader(headerDef, onClick) {
            return (
                <th onClick={onClick}>{headerDef.name}</th>
            );
        };
        
        class SortHeader extends React.Component {};

        class SortableTable extends React.Component {
            constructor(props) {
                super(props);
                this.state = {
                    sortColumn: null,
                    sortOrder: 1,
                };
            }

            render() {
                const rows = this.props.data.map((row) => (
                    <tr key={row.filter((ele, idx) => this.props.children[idx].key).concat()}>
                        {row.map((cell, idx) => <td key={idx}>{cell}</td>)}
                    </tr>
                ));
                return (
                    <Table>
                        <thead>
                            <tr>
                                {this.props.children.map((header) => SortingHeader(header, this.sort))}
                            </tr>
                        </thead>
                        <tbody>
                            {rows}
                        </tbody>
                    </Table>
                );
            }
        };

        function Attacks(character, attacks) {
            return (
                <SortableTable data={attacks}>
                    <SortHeader name="Speed"/>
                    <SortHeader name="Rank"/>
                    <SortHeader name="Base Damage"/>
                    <SortHeader name="Chip Damage"/>
                    <SortHeader name="Max Combo"/>
                    <SortHeader name="Max Damage"/>
                    <SortHeader name="Good Combo"/>
                    <SortHeader name="Good Damage"/>
                </SortableTable>
            );
        };

        function Throws(character, throws) {
            return (
                <SortableTable data={throws}>
                    <SortHeader name="Speed"/>
                    <SortHeader name="Rank"/>
                    <SortHeader name="Base Damage"/>
                    <SortHeader name="Max Combo"/>
                    <SortHeader name="Max Damage"/>
                    <SortHeader name="Good Combo"/>
                    <SortHeader name="Good Damage"/>
                </SortableTable>
            );
        };
        
        var destination = document.querySelector("#container");
        ReactDOM.render(
            <ReactRouter.Router history={ReactRouter.hashHistory}>
                <ReactRouter.Route path="/" component={YomiBase}>
                </ReactRouter.Route>
            </ReactRouter.Router>,
            destination
        );
    </script>
</body>

</html>
